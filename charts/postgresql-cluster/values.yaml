## Default values for postgresql-cluster

## @param enabled Whether to enable the PostgreSQL cluster
enabled: true

## @param cluster.name Name of the PostgreSQL cluster
## @param cluster.instances Number of instances in the cluster (replicas)
## @param cluster.primaryUpdateStrategy Strategy for updating the primary instance
## @param cluster.primaryUpdateMethod Method for updating the primary instance
cluster:
  name: postgres
  instances: 3
  primaryUpdateStrategy: unsupervised
  primaryUpdateMethod: switchover

## @param image.repository PostgreSQL container image repository
## @param image.tag PostgreSQL container image tag
image:
  repository: ghcr.io/cloudnative-pg/postgresql
  tag: "16.6"

## @param postgresql.parameters PostgreSQL configuration parameters
## @param postgresql.pgHBA PostgreSQL HBA configuration
postgresql:
  parameters:
    max_connections: "200"
    shared_buffers: "256MB"
    effective_cache_size: "1GB"
    maintenance_work_mem: "64MB"
    checkpoint_completion_target: "0.9"
    wal_buffers: "16MB"
    default_statistics_target: "100"
    random_page_cost: "1.1"
    effective_io_concurrency: "200"
    work_mem: "1310kB"
    min_wal_size: "1GB"
    max_wal_size: "4GB"
  pgHBA:
    - host all all all scram-sha-256

## @param bootstrap.initdb.database Name of the database to create
## @param bootstrap.initdb.owner Owner of the database
## @param bootstrap.initdb.secret.name Name of the secret containing database credentials
bootstrap:
  initdb:
    database: app
    owner: app
    secret:
      name: ""

## @param superuserSecret.name Name of the secret containing the superuser credentials
## @param superuserSecret.create Whether to create the superuser secret
## @param superuserSecret.username Superuser username (only if create=true)
## @param superuserSecret.password Superuser password (only if create=true, leave empty to auto-generate)
superuserSecret:
  name: postgres-superuser
  create: true
  username: postgres
  password: ""

## @param appSecret.name Name of the secret containing the app user credentials
## @param appSecret.create Whether to create the app user secret
## @param appSecret.username App user username (only if create=true)
## @param appSecret.password App user password (only if create=true, leave empty to auto-generate)
appSecret:
  name: postgres-app
  create: true
  username: app
  password: ""

## @param storage.size Size of the storage for each instance
## @param storage.storageClass Storage class name for persistent volumes
storage:
  size: 10Gi
  storageClass: ""

## @param monitoring.enabled Whether to enable monitoring
## @param monitoring.podMonitorEnabled Whether to create a PodMonitor resource
monitoring:
  enabled: true
  podMonitorEnabled: false

## @param backup.enabled Whether to enable backups
## @param backup.schedule Cron schedule for backups
## @param backup.retentionPolicy Backup retention policy
## @param backup.s3.enabled Whether to use S3 for backups
## @param backup.s3.bucket S3 bucket name
## @param backup.s3.region S3 region
## @param backup.s3.path Path within the S3 bucket
## @param backup.s3.endpointURL S3 endpoint URL (for S3-compatible storage)
## @param backup.s3.secret.name Name of secret containing S3 credentials
backup:
  enabled: false
  schedule: "0 0 * * *"
  retentionPolicy: "30d"
  s3:
    enabled: false
    bucket: ""
    region: us-east-1
    path: /backups
    endpointURL: ""
    secret:
      name: ""

## @param pooler.enabled Whether to enable PgBouncer connection pooler
## @param pooler.instances Number of PgBouncer instances
## @param pooler.type Type of PgBouncer pooler (rw or ro)
## @param pooler.poolMode PgBouncer pool mode (session, transaction, or statement)
## @param pooler.parameters PgBouncer configuration parameters
pooler:
  enabled: false
  instances: 3
  type: rw
  poolMode: transaction
  parameters:
    max_client_conn: "1000"
    default_pool_size: "25"

## @param resources.requests.cpu CPU request for PostgreSQL pods
## @param resources.requests.memory Memory request for PostgreSQL pods
## @param resources.limits.cpu CPU limit for PostgreSQL pods
## @param resources.limits.memory Memory limit for PostgreSQL pods
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2000m
    memory: 4Gi

## @param nodeSelector Node labels for pod assignment
nodeSelector: {}

## @param tolerations Tolerations for pod assignment
tolerations: []

## @param affinity Affinity rules for pod assignment
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: cnpg.io/cluster
                operator: In
                values:
                  - postgres
          topologyKey: kubernetes.io/hostname
