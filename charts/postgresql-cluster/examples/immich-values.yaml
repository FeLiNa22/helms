# Example: PostgreSQL for Immich
enabled: true

cluster:
  instances: 3

storage:
  size: 50Gi  # Immich stores lots of metadata
  storageClass: ""

superuserSecret:
  create: true
  username: postgres
  password: ""  # Auto-generated

appSecret:
  create: true
  username: immich
  password: ""  # Auto-generated

bootstrap:
  initdb:
    database: immich
    owner: immich

postgresql:
  parameters:
    max_connections: "300"
    shared_buffers: "1GB"
    effective_cache_size: "3GB"
    maintenance_work_mem: "256MB"
    checkpoint_completion_target: "0.9"
    wal_buffers: "16MB"
    default_statistics_target: "500"
    random_page_cost: "1.1"
    effective_io_concurrency: "200"
    work_mem: "3495kB"
    min_wal_size: "2GB"
    max_wal_size: "8GB"

resources:
  requests:
    cpu: 1000m
    memory: 2Gi
  limits:
    cpu: 4000m
    memory: 8Gi

backup:
  enabled: true
  schedule: "0 3 * * *"
  retentionPolicy: "30d"

# Highly recommended for Immich due to many concurrent connections
pooler:
  enabled: true
  instances: 3
  type: rw
  poolMode: transaction
  parameters:
    max_client_conn: "1000"
    default_pool_size: "30"
